
# Домашнее задание к занятию «Микросервисы: масштабирование»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Кластеризация

Предложите решение для обеспечения развёртывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- поддержка контейнеров;
- обеспечивать обнаружение сервисов и маршрутизацию запросов;
- обеспечивать возможность горизонтального масштабирования;
- обеспечивать возможность автоматического масштабирования;
- обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
- обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.

Обоснуйте свой выбор.


## Решение для обеспечения развертывания, запуска и управления приложениями

## Введение
Для обеспечения развертывания, запуска и управления приложениями, соответствующего указанным требованиям, предлагается решение на основе следующих программных продуктов и технологий:

1. **Docker**: Для контейнеризации приложений.
2. **Kubernetes**: Для оркестрации контейнеров.
3. **Helm**: Для управления пакетами Kubernetes.
4. **Envoy или Istio**: Для управления сервисами и маршрутизацией запросов.
5. **Kubernetes Secrets и ConfigMaps**: Для безопасного хранения конфигураций и чувствительных данных.

## Принципы взаимодействия

- **Контейнеризация**: Приложения упаковываются в Docker-контейнеры, что позволяет легко управлять их зависимостями и обеспечивать изоляцию.

- **Оркестрация**: Kubernetes управляет жизненным циклом контейнеров, обеспечивая автоматическое развертывание, обновление и масштабирование приложений. Он также следит за состоянием контейнеров и перезапускает их в случае сбоев.

- **Обнаружение сервисов и маршрутизация**: Envoy или Istio интегрируются с Kubernetes для обеспечения обнаружения сервисов и маршрутизации запросов. Это позволяет динамически направлять трафик между различными версиями сервисов и управлять их взаимодействием.

- **Масштабирование**: Kubernetes поддерживает как горизонтальное, так и автоматическое масштабирование. Горизонтальное масштабирование достигается путем добавления новых реплик подов, а автоматическое масштабирование может быть настроено на основе метрик, таких как загрузка CPU или использование памяти.

- **Безопасная конфигурация**: Kubernetes Secrets и ConfigMaps позволяют безопасно управлять конфигурациями и чувствительными данными. Это обеспечивает явное разделение ресурсов, доступных извне и внутри системы, так как конфиденциальные данные хранятся в защищенном виде и доступны только авторизованным сервисам.

## Обоснование выбора

- **Масштабируемость и гибкость**: Использование Docker и Kubernetes позволяет легко масштабировать приложения и адаптироваться к изменяющимся требованиям бизнеса.

- **Управляемость**: Kubernetes предоставляет мощные инструменты для управления состоянием приложений, что упрощает администрирование и мониторинг.

- **Безопасность**: Возможность безопасного хранения конфиденциальных данных и управление доступом к ним повышает уровень безопасности системы.

- **Сообщество и поддержка**: Docker и Kubernetes имеют большое сообщество и активную поддержку, что обеспечивает доступ к множеству ресурсов и инструментов для разработки и развертывания приложений.

## Заключение
Таким образом, предложенное решение обеспечивает все необходимые требования для эффективного развертывания, запуска и управления приложениями в контейнеризованной среде.


## Задача 2: Распределённый кеш * (необязательная)

Разработчикам вашей компании понадобился распределённый кеш для организации хранения временной информации по сессиям пользователей.
Вам необходимо построить Redis Cluster, состоящий из трёх шард с тремя репликами.

### Схема:

![11-04-01](https://user-images.githubusercontent.com/1122523/114282923-9b16f900-9a4f-11eb-80aa-61ed09725760.png)

Настройка кластера:

```conf
VM1

# /etc/redis/shard1/redis.conf
port 7000
cluster-enabled yes
cluster-config-file nodes-7000.conf
cluster-node-timeout 5000
appendonly yes

# /etc/redis/shard2/redis-replica.conf
port 7001
cluster-enabled yes
cluster-config-file nodes-7001.conf
cluster-node-timeout 5000
appendonly yes
daemonize yes



redis-server /etc/redis/shard1/redis.conf --protected-mode no
redis-server /etc/redis/shard2/redis-replica.conf --protected-mode no

VM2

# /etc/redis/shard2/redis.conf
port 7000
cluster-enabled yes
cluster-config-file nodes-7000.conf
cluster-node-timeout 5000
appendonly yes
daemonize yes


# /etc/redis/shard3/redis-replica.conf
port 7001
cluster-enabled yes
cluster-config-file nodes-7001.conf
cluster-node-timeout 5000
appendonly yes
daemonize yes


redis-server /etc/redis/shard2/redis.conf --protected-mode no
redis-server /etc/redis/shard3/redis-replica.conf --protected-mode no

VM3

# /etc/redis/shard3/redis.conf
port 7000
cluster-enabled yes
cluster-config-file nodes-7000.conf
cluster-node-timeout 5000
appendonly yes
daemonize yes


# /etc/redis/shard1/redis-replica.conf
port 7001
cluster-enabled yes
cluster-config-file nodes-7001.conf
cluster-node-timeout 5000
appendonly yes
daemonize yes


redis-server /etc/redis/shard3/redis.conf --protected-mode no
redis-server /etc/redis/shard1/redis-replica.conf --protected-mode no
```
Остановка кластера

```bash
redis-cli -p 7000 shutdown
redis-cli -p 7001 shutdown
```
Сборка кластера:

```bash
redis-cli --cluster create 10.1.0.8:7000 10.1.0.8:7001 10.1.0.27:7000 10.1.0.27:7001 10.1.0.19:7000 10.1.0.19:7001 --cluster-replicas 1
```

![image](https://github.com/user-attachments/assets/fc321034-7d6b-4111-b8d7-25107a534f27)


---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
